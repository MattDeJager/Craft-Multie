{% extends "multie/_layouts/index.twig" %}

{% import '_includes/forms' as forms %}

{% set crumbs = [
    { label: 'Multie'|t('plugin-handle'), url: url('multie') },
    { label: 'Fields'|t('plugin-handle'), url: url('multie') },
] %}

{% set fullPageForm = true %}

{% set showHeader = true %}
{% set fullPageForm = true %}
{% set selectedSubnavItem = 'fields' %}
{% set sites = craft.app.getSites().getAllSites() %}
{% set title = "Multie Site Manager" %}

{% block actionButton %}


{% endblock %}

{% block content %}
    {{ actionInput('multie/fields/update-all') }}
    {#    {{ redirectInput('settings/fields/{groupId}') }} #}
    {% if craft.app.getIsMultiSite() %}
        {% set translationMethods = field.supportedTranslationMethods %}
        {% if translationMethods|length > 1 %}
            <div id="translation-settings">
                {{ forms.selectField({
                    label: "Translation Method"|t('app'),
                    instructions: "How should this field’s values be translated?"|t('app'),
                    id: 'translation-method',
                    name: 'translationMethod',
                    options: [
                        'none' in translationMethods ? { value: 'none', label: "Not translatable"|t('app') },
                        'site' in translationMethods ? { value: 'site', label: "Translate for each site"|t('app') },
                        'siteGroup' in translationMethods ? { value: 'siteGroup', label: "Translate for each site group"|t('app') },
                        'language' in translationMethods ? { value: 'language', label: "Translate for each language"|t('app') },
                        'custom' in translationMethods ? { value: 'custom', label: "Custom…"|t('app') }
                    ]|filter,
                    value: field.translationMethod,
                    toggle: true,
                    targetPrefix: 'translation-method-'
                }) }}

                {% if 'custom' in translationMethods %}
                    {% tag 'div' with {
                        id: 'translation-method-custom',
                        class: field.translationMethod != 'custom' ? 'hidden' : null,
                    } %}
                        {{ forms.textField({
                            label: "Translation Key Format"|t('app'),
                            instructions: "Template that defines the field’s custom “translation key” format. Field values will be copied to all sites that produce the same key. For example, to make the field translatable based on the first two characters of the site handle, you could enter `{site.handle[:2]}`.",
                            id: 'translation-key-format',
                            class: 'code',
                            name: 'translationKeyFormat',
                            value: field.translationKeyFormat,
                            errors: field.getErrors('translationKeyFormat')
                        }) }}
                    {% endtag %}
                {% endif %}
            </div>
        {% endif %}

        {{ forms.selectField({
            label: 'Propagation Method'|t('app'),
            instructions: 'Which sites should blocks be saved to?'|t('app'),
            id: 'propagationMethod',
            name: 'propagationMethod',
            options: [
                { value: 'none', label: 'Only save blocks to the site they were created in'|t('app') },
                { value: 'siteGroup', label: 'Save blocks to other sites in the same site group'|t('app') },
                { value: 'language', label: 'Save blocks to other sites with the same language'|t('app') },
                { value: 'all', label: 'Save blocks to all sites the owner element is saved in'|t('app') },
                { value: 'custom', label: 'Custom…'|t('app') },
            ],

            toggle: true,
            targetPrefix: 'propagation-method-',
        }) }}

        {{ forms.checkboxField({
            label: 'Manage relations on a per-site basis'|t('app'),
            id: 'localize-relations',
            name: 'localizeRelations',
            checked: false
        }) }}

        {{ forms.submitButton([]) }}


    {% endif %}
{% endblock %}

{#        {% tag 'div' with { #}
{#            id: 'propagation-method-custom', #}
{#            class: matrixField.propagationMethod != 'custom' ? 'hidden' : null, #}
{#        } %} #}
{#            {{ forms.textField({ #}
{#                label: 'Propagation Key Format'|t('app'), #}
{#                instructions: 'Template that defines the field’s custom “propagation key” format. Blocks will be saved to all sites that produce the same key.'|t('app'), #}
{#                id: 'propagation-key-format', #}
{#                class: 'code', #}
{#                name: 'propagationKeyFormat', #}
{#                value: matrixField.propagationKeyFormat, #}
{#                errors: matrixField.getErrors('propagationKeyFormat'), #}
{#            }) }} #}
{#        {% endtag %} #}





